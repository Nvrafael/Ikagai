# Documentaci√≥n del Sistema de Nutrici√≥n

## üìã Resumen

Se han creado todas las migraciones, modelos y controladores necesarios para un sistema completo de nutrici√≥n que incluye:

- ‚úÖ Gesti√≥n de productos y categor√≠as
- ‚úÖ Sistema de rese√±as
- ‚úÖ Servicios del nutricionista
- ‚úÖ Reservas de consultas
- ‚úÖ Gesti√≥n de pedidos
- ‚úÖ Planes nutricionales
- ‚úÖ Sistema de mensajer√≠a

---

## üì¶ Entidades Creadas

### 1. **Categories** (Categor√≠as)
**Migraci√≥n:** `2025_10_21_000001_create_categories_table.php`  
**Modelo:** `Category.php`  
**Controlador:** `CategoryController.php`

**Campos:**
- `name` - Nombre de la categor√≠a
- `slug` - URL amigable
- `description` - Descripci√≥n
- `image` - Imagen de la categor√≠a
- `is_active` - Estado activo/inactivo

**Relaciones:**
- `hasMany` ‚Üí Products

---

### 2. **Products** (Productos)
**Migraci√≥n:** `2025_10_21_000002_create_products_table.php`  
**Modelo:** `Product.php`  
**Controlador:** `ProductController.php`

**Campos:**
- `category_id` - Categor√≠a del producto
- `name`, `slug`, `description` - Informaci√≥n b√°sica
- `price` - Precio actual
- `compare_price` - Precio de comparaci√≥n (antes/descuento)
- `stock` - Cantidad en inventario
- `sku` - C√≥digo de producto
- `images` - M√∫ltiples im√°genes (JSON)
- `is_active` - Estado activo/inactivo
- `is_featured` - Producto destacado
- `benefits` - Beneficios del producto
- `ingredients` - Ingredientes
- `weight` - Peso/tama√±o

**Relaciones:**
- `belongsTo` ‚Üí Category
- `hasMany` ‚Üí Reviews
- `hasMany` ‚Üí OrderItems

**M√©todos √∫tiles:**
- `averageRating()` - Calcula el promedio de calificaciones
- `hasStock($quantity)` - Verifica disponibilidad

---

### 3. **Reviews** (Rese√±as)
**Migraci√≥n:** `2025_10_21_000003_create_reviews_table.php`  
**Modelo:** `Review.php`  
**Controlador:** `ReviewController.php`

**Campos:**
- `product_id` - Producto rese√±ado
- `user_id` - Usuario que hizo la rese√±a
- `rating` - Calificaci√≥n (1-5)
- `title` - T√≠tulo de la rese√±a
- `comment` - Comentario
- `is_verified_purchase` - Compra verificada
- `is_approved` - Aprobada por admin

**Restricciones:**
- Un usuario solo puede dejar una rese√±a por producto

**Relaciones:**
- `belongsTo` ‚Üí Product
- `belongsTo` ‚Üí User

---

### 4. **Services** (Servicios)
**Migraci√≥n:** `2025_10_21_000004_create_services_table.php`  
**Modelo:** `Service.php`  
**Controlador:** `ServiceController.php`

**Campos:**
- `name`, `slug`, `description` - Informaci√≥n b√°sica
- `price` - Precio del servicio
- `duration` - Duraci√≥n en minutos
- `type` - Tipo de servicio (consultation, nutritional_plan, follow_up, workshop)
- `is_active` - Estado activo/inactivo
- `image` - Imagen del servicio
- `includes` - Qu√© incluye el servicio

**Relaciones:**
- `hasMany` ‚Üí Bookings

---

### 5. **Bookings** (Reservas)
**Migraci√≥n:** `2025_10_21_000005_create_bookings_table.php`  
**Modelo:** `Booking.php`  
**Controlador:** `BookingController.php`

**Campos:**
- `user_id` - Cliente que reserva
- `service_id` - Servicio reservado
- `scheduled_at` - Fecha y hora de la cita
- `status` - Estado (pending, confirmed, completed, cancelled)
- `notes` - Notas del cliente
- `nutritionist_notes` - Notas del nutricionista
- `price` - Precio en el momento de la reserva
- `payment_status` - Estado de pago
- `meeting_link` - Link de reuni√≥n virtual

**Relaciones:**
- `belongsTo` ‚Üí User
- `belongsTo` ‚Üí Service
- `hasOne` ‚Üí NutritionalPlan

**M√©todos √∫tiles:**
- `isConfirmed()` - Verifica si est√° confirmada
- `isCompleted()` - Verifica si est√° completada

---

### 6. **Orders** (Pedidos) y **OrderItems** (Items de Pedido)
**Migraciones:**
- `2025_10_21_000006_create_orders_table.php`
- `2025_10_21_000007_create_order_items_table.php`

**Modelos:** `Order.php`, `OrderItem.php`  
**Controlador:** `OrderController.php`

**Campos de Order:**
- `user_id` - Cliente
- `order_number` - N√∫mero de pedido √∫nico
- `status` - Estado (pending, processing, shipped, delivered, cancelled)
- `subtotal`, `tax`, `shipping`, `total` - Montos
- `payment_method`, `payment_status` - Informaci√≥n de pago
- `shipping_*` - Datos de env√≠o completos
- `notes` - Notas adicionales
- `tracking_number` - N√∫mero de seguimiento

**Campos de OrderItem:**
- `order_id` - Pedido al que pertenece
- `product_id` - Producto
- `quantity` - Cantidad
- `price` - Precio en el momento de la compra
- `subtotal` - Subtotal del item

**Relaciones:**
- Order `belongsTo` ‚Üí User
- Order `hasMany` ‚Üí OrderItems
- OrderItem `belongsTo` ‚Üí Order
- OrderItem `belongsTo` ‚Üí Product

**M√©todos √∫tiles:**
- `Order::generateOrderNumber()` - Genera n√∫mero √∫nico de pedido

---

### 7. **NutritionalPlans** (Planes Nutricionales)
**Migraci√≥n:** `2025_10_21_000008_create_nutritional_plans_table.php`  
**Modelo:** `NutritionalPlan.php`  
**Controlador:** `NutritionalPlanController.php`

**Campos:**
- `user_id` - Cliente
- `booking_id` - Consulta relacionada (opcional)
- `title`, `description` - Informaci√≥n b√°sica
- `objectives` - Objetivos nutricionales (JSON)
- `dietary_restrictions` - Restricciones alimentarias (JSON)
- `meal_plan` - Plan de comidas (JSON)
- `recommendations` - Recomendaciones generales
- `target_calories` - Calor√≠as objetivo
- `current_weight`, `target_weight` - Pesos
- `start_date`, `end_date` - Fechas de vigencia
- `is_active` - Estado activo
- `status` - Estado (active, completed, cancelled)

**Relaciones:**
- `belongsTo` ‚Üí User
- `belongsTo` ‚Üí Booking

**M√©todos √∫tiles:**
- `isActive()` - Verifica si est√° activo

---

### 8. **Messages** (Mensajes)
**Migraci√≥n:** `2025_10_21_000009_create_messages_table.php`  
**Modelo:** `Message.php`  
**Controlador:** `MessageController.php`

**Campos:**
- `sender_id` - Quien env√≠a
- `receiver_id` - Quien recibe
- `message` - Contenido del mensaje
- `is_read` - Si fue le√≠do
- `read_at` - Cu√°ndo fue le√≠do
- `attachments` - Archivos adjuntos (JSON)

**Relaciones:**
- `belongsTo` ‚Üí User (sender)
- `belongsTo` ‚Üí User (receiver)

**M√©todos √∫tiles:**
- `markAsRead()` - Marcar como le√≠do
- `Message::conversation($userId1, $userId2)` - Obtener conversaci√≥n

---

## üîß Modelo User Actualizado

Se agregaron las siguientes relaciones al modelo User:

```php
- reviews() - Rese√±as del usuario
- bookings() - Reservas del usuario
- orders() - Pedidos del usuario
- nutritionalPlans() - Planes nutricionales
- sentMessages() - Mensajes enviados
- receivedMessages() - Mensajes recibidos

// M√©todos helpers:
- isNutritionist() - Verifica si es nutricionista
- isClient() - Verifica si es cliente
- isAdmin() - Verifica si es administrador
```

---

## üõ£Ô∏è Rutas

Se cre√≥ el archivo `routes/example_routes.php` con todas las rutas sugeridas organizadas por:

1. **Rutas P√∫blicas** - Sin autenticaci√≥n (ver productos, servicios, categor√≠as)
2. **Rutas Autenticadas** - Para usuarios logueados (hacer pedidos, reservas, mensajes)
3. **Rutas de Nutricionista** - Gesti√≥n de servicios, planes, reservas
4. **Rutas de Administrador** - Gesti√≥n de pedidos, aprobaci√≥n de rese√±as

---

## üìù Pr√≥ximos Pasos

### 1. Ejecutar las Migraciones

```bash
php artisan migrate
```

### 2. Agregar las Rutas

Copia las rutas del archivo `routes/example_routes.php` a tu archivo `routes/web.php`.

### 3. Crear las Vistas

Necesitar√°s crear las vistas Blade para:
- Listados de productos, servicios, categor√≠as
- Detalle de producto con rese√±as
- Formularios de reserva
- Carrito de compras
- Checkout de pedidos
- Panel de mensajes
- Dashboard de nutricionista con planes

### 4. Configuraci√≥n Adicional

**Storage p√∫blico:**
```bash
php artisan storage:link
```

**Configurar filesystems** en `config/filesystems.php` si usar√°s archivos adjuntos en mensajes.

### 5. Seeders (Opcional)

Puedes crear seeders para datos de prueba:
```bash
php artisan make:seeder CategorySeeder
php artisan make:seeder ProductSeeder
php artisan make:seeder ServiceSeeder
```

---

## üé® Funcionalidades Implementadas

### Sistema de Productos
- ‚úÖ Categorizaci√≥n de productos
- ‚úÖ M√∫ltiples im√°genes por producto
- ‚úÖ Gesti√≥n de stock
- ‚úÖ Precios de comparaci√≥n (descuentos)
- ‚úÖ Productos destacados
- ‚úÖ B√∫squeda y filtros

### Sistema de Rese√±as
- ‚úÖ Calificaci√≥n de 1 a 5 estrellas
- ‚úÖ Una rese√±a por usuario por producto
- ‚úÖ Compra verificada
- ‚úÖ Aprobaci√≥n por administrador

### Sistema de Reservas
- ‚úÖ Diferentes tipos de servicios
- ‚úÖ Estados de reserva
- ‚úÖ Notas de cliente y nutricionista
- ‚úÖ Link de reuni√≥n virtual
- ‚úÖ Gesti√≥n de pagos

### Sistema de Pedidos
- ‚úÖ Carrito de compras completo
- ‚úÖ C√°lculo autom√°tico de impuestos y env√≠o
- ‚úÖ Datos de env√≠o completos
- ‚úÖ N√∫mero de pedido √∫nico
- ‚úÖ Estados de pedido
- ‚úÖ Seguimiento

### Planes Nutricionales
- ‚úÖ Objetivos personalizados
- ‚úÖ Restricciones alimentarias
- ‚úÖ Plan de comidas en JSON
- ‚úÖ Seguimiento de peso
- ‚úÖ Vinculaci√≥n con reservas

### Sistema de Mensajer√≠a
- ‚úÖ Chat entre usuario y nutricionista
- ‚úÖ Archivos adjuntos
- ‚úÖ Estado de lectura
- ‚úÖ Contador de no le√≠dos

---

## üîí Seguridad y Validaciones

Todos los controladores incluyen:
- ‚úÖ Validaci√≥n de datos de entrada
- ‚úÖ Verificaci√≥n de permisos (usuarios solo pueden ver/editar sus propios datos)
- ‚úÖ Protecci√≥n contra duplicados
- ‚úÖ Transacciones de base de datos para operaciones cr√≠ticas
- ‚úÖ Sanitizaci√≥n de slugs

---

## üí° Consejos de Implementaci√≥n

1. **Carrito de Compras**: Considera usar sesiones o una tabla `cart_items` para persistir el carrito.

2. **Pagos**: Integra con pasarelas como Stripe, PayPal o MercadoPago.

3. **Notificaciones**: Implementa notificaciones por email cuando:
   - Se crea una reserva
   - Se confirma una reserva
   - Se crea un pedido
   - Llega un nuevo mensaje

4. **API**: Todos estos controladores pueden adaptarse f√°cilmente para crear una API REST.

5. **Permisos**: El middleware `RoleMiddleware` ya existe, √∫salo en las rutas con roles espec√≠ficos.

---

## üìö Estructura de Archivos Creados

```
database/migrations/
‚îú‚îÄ‚îÄ 2025_10_21_000001_create_categories_table.php
‚îú‚îÄ‚îÄ 2025_10_21_000002_create_products_table.php
‚îú‚îÄ‚îÄ 2025_10_21_000003_create_reviews_table.php
‚îú‚îÄ‚îÄ 2025_10_21_000004_create_services_table.php
‚îú‚îÄ‚îÄ 2025_10_21_000005_create_bookings_table.php
‚îú‚îÄ‚îÄ 2025_10_21_000006_create_orders_table.php
‚îú‚îÄ‚îÄ 2025_10_21_000007_create_order_items_table.php
‚îú‚îÄ‚îÄ 2025_10_21_000008_create_nutritional_plans_table.php
‚îî‚îÄ‚îÄ 2025_10_21_000009_create_messages_table.php

app/Models/
‚îú‚îÄ‚îÄ Category.php
‚îú‚îÄ‚îÄ Product.php
‚îú‚îÄ‚îÄ Review.php
‚îú‚îÄ‚îÄ Service.php
‚îú‚îÄ‚îÄ Booking.php
‚îú‚îÄ‚îÄ Order.php
‚îú‚îÄ‚îÄ OrderItem.php
‚îú‚îÄ‚îÄ NutritionalPlan.php
‚îú‚îÄ‚îÄ Message.php
‚îî‚îÄ‚îÄ User.php (actualizado)

app/Http/Controllers/
‚îú‚îÄ‚îÄ CategoryController.php
‚îú‚îÄ‚îÄ ProductController.php
‚îú‚îÄ‚îÄ ReviewController.php
‚îú‚îÄ‚îÄ ServiceController.php
‚îú‚îÄ‚îÄ BookingController.php
‚îú‚îÄ‚îÄ OrderController.php
‚îú‚îÄ‚îÄ NutritionalPlanController.php
‚îî‚îÄ‚îÄ MessageController.php

routes/
‚îî‚îÄ‚îÄ example_routes.php
```

---

## ‚ú® ¬°Listo para usar!

El sistema est√° completo y listo para que comiences a crear las vistas y personalizar seg√∫n tus necesidades espec√≠ficas.

